<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="img/fit-black-icon.png">
    <!-- bootstrap link -->
    <link rel="stylesheet" href="bootstrap-5.3.3-dist/css/bootstrap.min.css">

    <!-- slick slider -->
    <link rel="stylesheet" href="plugins/slick-1.8.1/slick/slick.css">
    <link rel="stylesheet" href="plugins/slick-1.8.1/slick/slick-theme.css">

    <!-- fontawesome link -->
    <script src="https://kit.fontawesome.com/026ee307aa.js" crossorigin="anonymous"></script>


    <link rel="stylesheet" href="css/style.css">
    <title>FitPro</title>
</head>

<body class="g-sidenav-show bg-black">
    <aside class="sidebar d-flex flex-column flex-shrink-0">
        <a href="#" class="sidebar-head">
            <div id="navbar-brand" class="navbar-brand">
                <img src="img/fit-logo-w.png" alt="fitpro" class="w-100">
            </div>
            <div class="bars">
                <i class="sidenav-toggler-line one"></i>
                <i class="sidenav-toggler-line two"></i>
                <i class="sidenav-toggler-line three"></i>
            </div>
        </a>
        <div class=" navbar-collapse  w-auto " id="sidenav-collapse-main">
            <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
                <li class="nav-item">
                    <a href="#" class="nav-link active py-3 border-bottom" aria-current="page">
                        <i class="fa fa-house"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="workout-plan.html" class="nav-link py-3 border-bottom">
                        <i class="fa fa-dumbbell"></i>
                        <span>Workout Plan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link py-3 border-bottom">
                        <i class="fa fa-utensils"></i>
                        <span>Diet Plan</span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="sidenav-footer">
            <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
                <li class="nav-item">
                    <a href="#" class="nav-link py-3 border-bottom"><i class="fa fa-circle-info"></i>Help</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link py-3 "><i class="fa fa-right-from-bracket"></i>Logout</a>
                </li>
            </ul>
        </div>
    </aside>
    <!-- <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0" id="sidenav-main">
        <div class="sidenav-header">
            <i class="fas fa-times cursor-pointer position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true"
                id="iconSidenav"></i>
            <a id="navbar-brand" class="navbar-brand" href="">
                <img src="img/fit-logo-b.png" class="navbar-brand-img" alt="main_logo">
            </a>
            <div class="sidenav-toggle" onclick="toggleSidebar()">
                <a href="#" class="toggle-button" id="iconNavbarSidenav">
                    <div class="sidenav-toggler-inner">
                        <i class="sidenav-toggler-line one"></i>
                        <i class="sidenav-toggler-line two"></i>
                        <i class="sidenav-toggler-line three"></i>
                    </div>
                </a>
            </div>
        </div>
        <div class=" navbar-collapse  w-auto " id="sidenav-collapse-main">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link active" href="/">
                        <i class="fa fa-desktop fa-xl"></i>
                        <span class="nav-link-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="doctor-worklist.html">
                        <i class="fa fa-stethoscope fa-xl"></i>
                        <span class="nav-link-text">Doctor Worklist</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="/triage.html">
                        <i class="fa fa-user-doctor fa-xl"></i>
                        <span class="nav-link-text">Triage</span>
                    </a>
                </li>
            </ul>
        </div>
    </aside> -->
    <div id="dashboardContent" class="main-content dashboard">
        <header class="d-header">
            <div class="header-content">
                <div class="title">
                    <span>Good Morning</span>
                    <h2 class="mb-0">Welcome Back!</h2>
                </div>
                <ul class="nav col-12 col-lg-auto mb-2 mb-md-0">
                    <button class="premium btn">
                        Try Premium
                        <i class="fa fa-chevron-right"></i>
                    </button>
                    <li class="nav-item">
                        <a href="#" class="nav-link"><i class="fa fa-bell"></i></a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link"><i class="fa fa-gear"></i></a>
                    </li>
                    <div class="dropdown">
                        <a href="#" class="d-block dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fa fa-user"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">New project...</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li><a class="dropdown-item" href="#">Profile</a></li>
                            <li><a class="dropdown-item" href="sign-in.html">Sign out</a></li>
                        </ul>
                    </div>
                </ul>
            </div>
        </header>
        <div class="main">
            <div class="row">
                <div class="col-lg-9">
                    <div class="banner">
                        <div class="content">
                            <h2>Track Your Daily Activities</h2>
                            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Modi deserunt vel quia cum.
                                Officiis, dolore, autem reprehenderit eveniet eum iusto magnam, incidunt veniam corrupti
                                illum ullam dignissimos sint unde amet.</p>
                        </div>
                        <!-- <div class="image">
                            <img src="img/dashboard-banner.png" alt="Exercise Image">
                        </div> -->
                    </div>
                    <div class="first-section">
                        <div class="content">
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="titles">
                                                <h4 class="card-subtitle">Protiens</h4>
                                                <h2 class="card-title counter1">0<span>g</span></h2>
                                            </div>
                                            <div class="icon">
                                                <i class="fa fa-drumstick-bite"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="titles">
                                                <h4 class="card-subtitle">Fats</h4>
                                                <h2 class="card-title counter2">0<span>g</span></h2>
                                            </div>
                                            <div class="icon">
                                                <i class="fa fa-bacon"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="titles">
                                                <h4 class="card-subtitle">Carbs</h4>
                                                <h2 class="card-title counter3">0<span>g</span></h2>
                                            </div>
                                            <div class="icon">
                                                <i class="fa fa-apple-alt"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="titles">
                                                <h4 class="card-subtitle">Calories</h4>
                                                <h2 class="card-title counter4">0<span>g</span></h2>
                                            </div>
                                            <div class="icon">
                                                <i class="fa fa-utensils"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="second-section">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="chart">
                                    <h2 class="custom-title">Calories</h2>
                                    <div id="pie-1" class="pie"></div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="chart">
                                    <h2 class="custom-title">Macros</h2>
                                    <div id="pie-2" class="premium-chart pie"></div>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="calorie-btn">
                                    <button class="btn calorie-goal" data-bs-toggle="modal"
                                        data-bs-target="#calorieModal"><i class="fa fa-plus me-2"></i>Add Calorie
                                        Goal</button>
                                </div>
                                <div class="modal fade" id="calorieModal" tabindex="-1"
                                    aria-labelledby="calorieModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content bg-dark">
                                            <div class="modal-header">
                                                <h5 class="modal-title text-white" id="calorieModalLabel">Calorie Goal
                                                    Input</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"><i class="fa fa-xmark text-white"></i></button>
                                            </div>
                                            <div class="modal-body">
                                                <!-- Form for User Input -->
                                                <form id="calorieForm" class="calorieForm">
                                                    <div class="form-group">
                                                        <label for="weight" class="form-label">Weight (kg):</label>
                                                        <input type="number" class="form-control" id="weight"
                                                            placeholder="weight in kg" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="height" class="form-label">Height (cm):</label>
                                                        <input type="number" class="form-control" id="height"
                                                            placeholder="height in cm" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="age" class="form-label">Age:</label>
                                                        <input type="number" class="form-control" id="age"
                                                            placeholder="your age" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="gender" class="form-label">Gender:</label>
                                                        <select class="form-control" id="gender" required>
                                                            <option value="male">Male</option>
                                                            <option value="female">Female</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="goal" class="form-label">Goal:</label>
                                                        <select class="form-control" id="goal" required>
                                                            <option value="maintain">Maintain Weight</option>
                                                            <option value="gain">Gain Weight</option>
                                                            <option value="lose">Lose Weight</option>
                                                        </select>
                                                    </div>
                                                    <button type="submit" class="btn submit">Submit</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="third-section">
                        <div class="schedule">
                            <div class="title">
                                <h3 class="mb-0">My Schedule</h3>
                                <a href="#" class="viewAll">View All <i class="fa fa-chevron-right"></i></a>
                            </div>
                            <div class="content">
                                <div class="card">
                                    <div class="card-body">
                                        <h4>Monday</h4>
                                        <div class="exercise">
                                            <div class="text">
                                                <h5>Stretch</h5>
                                                <span>At 08:00</span>
                                            </div>
                                            <div class="pieces">
                                                <span class="badge bg-warning">20 Pieces</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h4>Tuesday</h4>
                                        <div class="exercise">
                                            <div class="text">
                                                <h5>Back Stretch</h5>
                                                <span>At 08:00</span>
                                            </div>
                                            <div class="pieces">
                                                <span class="badge bg-warning">10 Round</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h4>Wednesday</h4>
                                        <div class="exercise">
                                            <div class="text">
                                                <h5>Yoga</h5>
                                                <span>At 08:00</span>
                                            </div>
                                            <div class="pieces">
                                                <span class="badge bg-warning">20 min</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="goals">
                            <div class="title">
                                <h3 class="mb-0">Goals</h3>
                                <a href="#" class="viewAll">View All <i class="fa fa-chevron-right"></i></a>
                            </div>
                            <div class="content">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="exercise">
                                            <div class="text">
                                                <h5>Running on Track</h5>
                                                <span>Saturday, April 14, 08:00 AM</span>
                                            </div>
                                            <div class="pieces">
                                                <span class="badge bg-warning">04 Rounds</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="exercise">
                                            <div class="text">
                                                <h5>Push Up</h5>
                                                <span>Sunday, April 15, 08:00 AM</span>
                                            </div>
                                            <div class="pieces">
                                                <span class="badge bg-warning">50 Pieces</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- bootstrap link -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-migrate/3.5.2/jquery-migrate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/5.2.0/js/bootstrap.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/variable-pie.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>
    <script src="plugins/slick-1.8.1/slick/slick.min.js"></script>
    <script src="plugins/jquery-validation-1.19.5/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="js/script.js"></script>

    <script>

        let calculatedCalories = null;

        function updateCards(calories, macros) {
            // Update calories card
            document.querySelector('.counter4').innerHTML = `${calories}<span>g</span>`;

            // Update proteins card
            document.querySelector('.counter1').innerHTML = `${macros.proteins}<span>g</span>`;

            // Update fats card
            document.querySelector('.counter2').innerHTML = `${macros.fats}<span>g</span>`;

            // Update carbs card
            document.querySelector('.counter3').innerHTML = `${macros.carbs}<span>g</span>`;
        }

        function calculateCalories(weight, height, age, gender, goal) {
            let bmr;
            if (gender === 'male') {
                // BMR formula for males
                bmr = 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                // BMR formula for females
                bmr = 10 * weight + 6.25 * height - 5 * age - 161;
            }

            // Adjust BMR based on the goal
            switch (goal) {
                case 'gain':
                    return Math.round(bmr * 1.2 + 500); // Gain weight
                case 'lose':
                    return Math.round(bmr * 1.2 - 500); // Lose weight
                default:
                    return Math.round(bmr * 1.2); // Maintain weight
            }
        }

        function calculateMacros(totalCalories, weight) {
            const proteinGrams = Math.round(weight * 1.6); // 1.6g of protein per kg of body weight
            const proteinCalories = proteinGrams * 4;     // 1g protein = 4 calories

            const fatCalories = Math.round(totalCalories * 0.25); // 25% of total calories for fats
            const fatGrams = Math.round(fatCalories / 9);         // 1g fat = 9 calories

            const remainingCalories = totalCalories - (proteinCalories + fatCalories);
            const carbGrams = Math.round(remainingCalories / 4); // 1g carb = 4 calories

            return {
                proteins: proteinGrams,
                fats: fatGrams,
                carbs: carbGrams
            };
        }

        document.getElementById('calorieForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const goal = document.getElementById('goal').value;

            if (weight > 0 && height > 0 && age > 0) {
                calculatedCalories = calculateCalories(weight, height, age, gender, goal);
                const macros = calculateMacros(calculatedCalories, weight);

                $('#calorieModal').modal('hide');
                renderChart(calculatedCalories, 0); 
                renderChart2(macros);              

                updateCards(calculatedCalories, macros);
            } else {
                alert('Please enter valid values for weight, height, and age.');
            }
        });

        function renderChart(caloriesRemaining, consumedCalories) {
            Highcharts.chart('pie-1', {
                chart: {
                    type: 'pie',
                    backgroundColor: '#1C1C1C',
                    events: {
                        render() {
                            const chart = this;
                            const series = chart.series[0];
                            let customLabel = chart.options.chart.custom?.label;

                            if (!customLabel) {
                                customLabel = chart.options.chart.custom = {};
                                customLabel.label = chart.renderer.label(
                                    `<h4 style="text-align:center;">
                                <span>${caloriesRemaining !== null ? caloriesRemaining : 'null'}</span><br>Remaining
                             </h4>`
                                ).css({
                                    color: '#fff',
                                    fontWeight: 'bold',
                                    textAlign: 'center'
                                }).add();
                            }

                            const centerX = series.center[0] + chart.plotLeft;
                            const centerY = series.center[1] + chart.plotTop;

                            customLabel.label.attr({
                                x: centerX - (customLabel.label.getBBox().width / 2),
                                y: centerY - (customLabel.label.getBBox().height / 2)
                            }).css({
                                fontSize: `${series.center[2] / 8}px`
                            });
                        }
                    }
                },
                title: { text: '' },
                tooltip: {
                    headerFormat: '',
                    pointFormat: '<span style="color:{point.color}">\u25CF</span> <b>{point.name}</b><br/>' +
                        'Amount: <b>{point.y}</b><br/>'
                },
                legend: {
                    enabled: true,
                    layout: 'horizontal',
                    align: 'center',
                    verticalAlign: 'bottom',
                    itemStyle: { fontSize: '14px', color: '#fff' }
                },
                credits: { enabled: false },
                plotOptions: {
                    pie: {
                        dataLabels: { enabled: false },
                        borderWidth: 2,
                        borderColor: '#1C1C1C'
                    }
                },
                series: [{
                    name: 'Calories',
                    innerSize: '80%', // Doughnut chart
                    showInLegend: true,
                    data: [{
                        name: 'Consumed',
                        y: consumedCalories || 0,
                        color: '#BDBDBD'
                    }, {
                        name: 'Calories Remaining',
                        y: caloriesRemaining || 2000,
                        color: '#00ADB5'
                    }]
                }]
            });
        }

        function renderChart2(macros = { proteins: null, fats: null, carbs: null }) {
            Highcharts.chart('pie-2', {
                chart: {
                    type: 'pie',
                    backgroundColor: '#1C1C1C',
                    events: {
                        render() {
                            const chart = this, series = chart.series[0];

                            // Custom Center Text
                            if (!chart.customLabel) {
                                chart.customLabel = chart.renderer.text(
                                    `<div style="text-align:center; color:#fff; font-weight:bold;">
                                Carbs: ${macros.carbs || 0}g<br>
                                Fats: ${macros.fats || 0}g<br>
                                Proteins: ${macros.proteins || 0}g
                            </div>`,
                                    0, 0
                                ).css({
                                    width: series.center[3] + 'px',
                                    color: '#fff',
                                    fontSize: '20px'
                                }).add();
                            }

                            // Position Center Text Dynamically
                            const x = chart.plotLeft + series.center[0] - (chart.customLabel.getBBox().width / 2);
                            const y = chart.plotTop + series.center[1] - (chart.customLabel.getBBox().height / 2);
                            chart.customLabel.attr({ x: x, y: y });
                        }
                    }
                },
                title: { text: '' },
                tooltip: {
                    headerFormat: '',
                    pointFormat: '<span style="color:{point.color}">\u25CF</span> <b>{point.name}</b><br/>Amount: <b>{point.y}g</b>'
                },
                legend: {
                    enabled: true,
                    layout: 'horizontal',
                    align: 'center',
                    verticalAlign: 'bottom',
                    itemStyle: { fontSize: '16px', color: '#fff' }
                },
                credits: { enabled: false },
                plotOptions: {
                    pie: {
                        dataLabels: { enabled: false },
                        showInLegend: true
                    }
                },
                series: [{
                    name: 'Macros',
                    innerSize: '80%',
                    data: [
                        { name: 'Proteins', y: macros.proteins || 0, color: '#FFC107' },
                        { name: 'Fats', y: macros.fats || 0, color: '#4CAF50' },
                        { name: 'Carbs', y: macros.carbs || 0, color: '#00ADB5' }
                    ]
                }]
            });
        }

        renderChart(null, 0);
        renderChart2();


    </script>
</body>

</html>